<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Learning - LearnHub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Source Sans Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f8f9fc;
            color: #1f1f1f;
            overflow-x: hidden;
        }

        /* ========== ANIMATIONS ========== */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* ========== SIDEBAR ========== */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: linear-gradient(180deg, #1a1d2e 0%, #16192b 100%);
            color: #fff;
            z-index: 1000;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 4px 0 24px rgba(0, 0, 0, 0.12);
            overflow-y: auto;
            overflow-x: hidden;
        }

        .sidebar.collapsed {
            width: 80px;
        }

        .sidebar-header {
            padding: 24px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            gap: 12px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 700;
            color: #fff;
            text-decoration: none;
            white-space: nowrap;
            overflow: hidden;
        }

        .logo i {
            font-size: 28px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            flex-shrink: 0;
        }

        .sidebar.collapsed .logo-text {
            display: none;
        }

        .toggle-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #fff;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .toggle-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .sidebar-nav {
            padding: 20px 0;
        }

        .nav-section {
            margin-bottom: 28px;
        }

        .nav-section-title {
            padding: 0 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 12px;
            white-space: nowrap;
            overflow: hidden;
        }

        .sidebar.collapsed .nav-section-title {
            display: none;
        }

        .nav-item {
            padding: 14px 20px;
            display: flex;
            align-items: center;
            gap: 14px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            text-decoration: none;
            white-space: nowrap;
            overflow: hidden;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            transform: scaleY(0);
            transition: transform 0.3s;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }

        .nav-item.active {
            background: rgba(102, 126, 234, 0.15);
            color: #fff;
        }

        .nav-item.active::before {
            transform: scaleY(1);
        }

        .nav-item i {
            font-size: 20px;
            width: 24px;
            text-align: center;
            flex-shrink: 0;
        }

        .nav-item-text {
            font-size: 15px;
            font-weight: 500;
            flex: 1;
        }

        .sidebar.collapsed .nav-item-text {
            display: none;
        }

        .nav-badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
        }

        .sidebar.collapsed .nav-badge {
            display: none;
        }

        /* ========== TOPBAR ========== */
        .topbar {
            position: fixed;
            top: 0;
            left: 280px;
            right: 0;
            height: 70px;
            background: #fff;
            border-bottom: 1px solid #e8ecf1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 32px;
            z-index: 999;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .sidebar.collapsed ~ .topbar {
            left: 80px;
        }

        .search-box {
            flex: 1;
            max-width: 500px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 44px 12px 16px;
            border: 2px solid #e8ecf1;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s;
            background: #f8f9fc;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
            background: #fff;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .search-box i {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .topbar-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .notification-btn {
            position: relative;
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: #f8f9fc;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            color: #666;
        }

        .notification-btn:hover {
            background: #667eea;
            color: #fff;
            transform: translateY(-2px);
        }

        .notification-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 8px;
            height: 8px;
            background: #ff6b6b;
            border-radius: 50%;
            border: 2px solid #fff;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 12px;
            transition: all 0.3s;
        }

        .user-menu:hover {
            background: #f8f9fc;
        }

        .user-avatar {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            font-size: 14px;
            color: #1f1f1f;
        }

        .user-role {
            font-size: 12px;
            color: #999;
        }

        /* ========== MAIN CONTENT ========== */
        .main-content {
            margin-left: 280px;
            margin-top: 70px;
            padding: 32px;
            min-height: calc(100vh - 70px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar.collapsed ~ .topbar ~ .main-content {
            margin-left: 80px;
        }

        .page-header {
            margin-bottom: 32px;
            animation: fadeIn 0.6s ease;
        }

        .page-header h1 {
            font-size: 32px;
            font-weight: 700;
            color: #1f1f1f;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .page-header p {
            font-size: 16px;
            color: #666;
        }

        /* ========== TAB CONTENT ========== */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        /* ========== COURSE GRID ========== */
        .course-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 32px;
            margin-bottom: 40px;
        }

        .course-card {
            background: #fff;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0,0,0,0.06);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border: 1px solid #e8ecf1;
            animation: scaleIn 0.4s ease backwards;
        }

        .course-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 32px rgba(102, 126, 234, 0.15);
            border-color: #667eea;
        }

        .course-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            display: block;
            background: linear-gradient(135deg, #667eea, #764ba2);
            transition: transform 0.3s;
        }

        .course-card:hover .course-image {
            transform: scale(1.05);
        }

        .course-body {
            padding: 20px;
        }

        .course-title {
            font-size: 18px;
            font-weight: 700;
            color: #1f1f1f;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .course-meta-row {
            display:flex;
            align-items:center;
            gap:12px;
            margin-bottom:12px;
        }

        .instructor-avatar {
            width:36px;height:36px;border-radius:50%;overflow:hidden;border:2px solid #fff;box-shadow:0 2px 6px rgba(16,24,40,0.06);
        }

        .badge {
            display:inline-block;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:700;background:#eef2ff;color:#024ea2;margin-left:6px
        }

        .course-instructor {
            font-size: 14px;
            color: #666;
            margin-bottom: 16px;
        }

        .progress-container {
            margin-bottom: 12px;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 6px;
            transition: width 0.5s ease;
        }

        .course-actions {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .btn {
            flex: 1;
            padding: 10px 16px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            text-align: center;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid #e8ecf1;
            color: #666;
        }

        .btn-outline:hover {
            border-color: #667eea;
            color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        /* ========== STATS CARDS ========== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
            animation: fadeIn 0.6s ease 0.2s backwards;
        }

        .stat-card {
            background: #fff;
            padding: 28px;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.06);
            border: 1px solid #e8ecf1;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
        }

        .stat-card:hover::before {
            transform: scaleX(1);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .stat-title {
            font-size: 13px;
            font-weight: 600;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-icon {
            width: 52px;
            height: 52px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .stat-icon.blue {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            color: #1976d2;
        }

        .stat-icon.green {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            color: #43a047;
        }

        .stat-icon.orange {
            background: linear-gradient(135deg, #fff3e0, #ffe0b2);
            color: #fb8c00;
        }

        .stat-icon.purple {
            background: linear-gradient(135deg, #f3e5f5, #e1bee7);
            color: #8e24aa;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
        }

        /* ========== RECOMMENDATIONS ========== */
        .recommendations {
            background: #fff;
            padding: 32px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 40px;
        }

        .recommendations h2 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #1f1f1f;
        }

        .recommendations p {
            color: #666;
            margin-bottom: 24px;
        }

        .recommendation-list {
            display: flex;
            gap: 24px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .recommendation-card {
            min-width: 280px;
            background: #f7f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            transition: all 0.3s;
            cursor: pointer;
        }

        .recommendation-card:hover {
            background: #fff;
            border-color: #0056d2;
            transform: translateY(-2px);
        }

        .recommendation-card h3 {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #1f1f1f;
        }

        .recommendation-card .course-meta {
            font-size: 13px;
            color: #666;
            margin-bottom: 12px;
        }

        .recommendation-card .btn-sm {
            padding: 8px 16px;
            font-size: 13px;
        }

        /* ========== EMPTY STATE ========== */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            animation: fadeIn 0.6s ease;
        }

        .empty-state i {
            font-size: 80px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 24px;
            display: inline-block;
        }

        .empty-state h3 {
            font-size: 26px;
            font-weight: 700;
            color: #1f1f1f;
            margin-bottom: 12px;
        }

        .empty-state p {
            font-size: 16px;
            color: #666;
            margin-bottom: 28px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .empty-state .btn {
            display: inline-block;
            padding: 14px 32px;
        }

        /* ========== LIVE SESSIONS ========== */
        .live-session-card {
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .live-session-card:hover {
            border-color: #0056d2;
            box-shadow: 0 4px 12px rgba(0, 86, 210, 0.1);
            transform: translateY(-2px);
        }

        .live-session-card.upcoming {
            border-left: 5px solid #0056d2;
            background: linear-gradient(135deg, #e8f1fc 0%, #f0f7ff 100%);
        }

        .live-session-card.live-now {
            border-left: 5px solid #00a854;
            background: linear-gradient(135deg, #e6f9f0 0%, #f0fff5 100%);
        }

        .session-badge {
            position: absolute;
            top: 16px;
            right: 16px;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .session-badge.upcoming {
            background: #0056d2;
            color: #fff;
        }

        .session-badge.live {
            background: #00a854;
            color: #fff;
            animation: pulse 1.5s infinite;
        }

        .session-badge.past {
            background: #999;
            color: #fff;
        }

        .live-session-header {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 16px;
        }

        .session-course-thumb {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
        }

        .session-info {
            flex: 1;
        }

        .session-course-title {
            font-size: 13px;
            color: #666;
            margin-bottom: 4px;
        }

        .session-title {
            font-size: 20px;
            font-weight: 600;
            color: #1f1f1f;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .session-title i {
            color: #0056d2;
        }

        .session-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 16px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #666;
        }

        .meta-item i {
            color: #0056d2;
            width: 18px;
        }

        .time-indicator {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 16px;
            text-align: center;
        }

        .time-indicator.urgent {
            background: #fff3e0;
            color: #ff6b00;
        }

        .time-indicator.soon {
            background: #e8f1fc;
            color: #0056d2;
        }

        .time-indicator.live {
            background: #e6f9f0;
            color: #00a854;
        }

        .session-actions {
            display: flex;
            gap: 12px;
        }

        .btn-join-session {
            flex: 1;
            padding: 14px 24px;
            background: #0056d2;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-decoration: none;
        }

        .btn-join-session:hover {
            background: #004bb5;
            transform: scale(1.02);
        }

        .btn-join-session.disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .topbar {
                left: 0;
            }

            .main-content {
                margin-left: 0;
            }

            .sidebar-overlay {
                display: block;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 999;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s;
            }

            .sidebar-overlay.active {
                opacity: 1;
                visibility: visible;
            }

            .mobile-menu-btn {
                display: flex !important;
            }
        }

        @media (max-width: 768px) {
            .search-box {
                display: none;
            }

            .topbar {
                padding: 0 16px;
            }

            .main-content {
                padding: 20px 16px;
            }

            .page-header h1 {
                font-size: 24px;
            }

            .course-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .user-info {
                display: none;
            }
        }

        .sidebar-overlay {
            display: none;
        }

        .mobile-menu-btn {
            display: none;
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: #f8f9fc;
            border: none;
            cursor: pointer;
            align-items: center;
            justify-content: center;
            color: #666;
        }

        .mobile-menu-btn:hover {
            background: #667eea;
            color: #fff;
        }
    </style>
</head>
<body>
    <!-- SIDEBAR OVERLAY FOR MOBILE -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="/" class="logo">
                <i class="fas fa-graduation-cap"></i>
                <span class="logo-text">LearnHub</span>
            </a>
            <button class="toggle-btn" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <nav class="sidebar-nav">
            <div class="nav-section">
                <div class="nav-section-title">Learning</div>
                <div class="nav-item active" onclick="switchTab('all')">
                    <i class="fas fa-th-large"></i>
                    <span class="nav-item-text">All Courses</span>
                </div>
                <div class="nav-item" onclick="switchTab('in-progress')">
                    <i class="fas fa-play-circle"></i>
                    <span class="nav-item-text">In Progress</span>
                </div>
                <div class="nav-item" onclick="switchTab('completed')">
                    <i class="fas fa-check-circle"></i>
                    <span class="nav-item-text">Completed</span>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Assessment</div>
                <div class="nav-item" onclick="switchTab('exams')">
                    <i class="fas fa-file-alt"></i>
                    <span class="nav-item-text">Exams</span>
                </div>
                <div class="nav-item" onclick="switchTab('results')">
                    <i class="fas fa-chart-bar"></i>
                    <span class="nav-item-text">My Results</span>
                </div>
                <div class="nav-item" onclick="switchTab('certificates')">
                    <i class="fas fa-certificate"></i>
                    <span class="nav-item-text">Certificates</span>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Community</div>
                <div class="nav-item" onclick="switchTab('live-sessions')">
                    <i class="fas fa-video"></i>
                    <span class="nav-item-text">Live Sessions</span>
                </div>
                <div class="nav-item" onclick="switchTab('wishlist')">
                    <i class="fas fa-heart"></i>
                    <span class="nav-item-text">Wishlist</span>
                </div>
            </div>
        </nav>
    </aside>

    <!-- TOPBAR -->
    <header class="topbar">
        <button class="mobile-menu-btn" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </button>
        <div class="search-box">
            <input type="text" placeholder="Search my courses..." id="searchCourses">
            <i class="fas fa-search"></i>
        </div>
        <div class="topbar-right">
            <button class="notification-btn">
                <i class="fas fa-bell"></i>
                <span class="notification-badge"></span>
            </button>
            <div class="user-menu" onclick="logout()">
                <div class="user-avatar">
                    <span id="userInitial">S</span>
                </div>
                <div class="user-info">
                    <div class="user-name" id="userName">Student</div>
                    <div class="user-role">Learner</div>
                </div>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="main-content">
        <!-- PAGE HEADER -->
        <div class="page-header">
            <h1>My Learning Dashboard</h1>
            <p>Track your progress and continue where you left off</p>
        </div>

        <!-- STATS GRID -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-title">Enrolled Courses</div>
                    <div class="stat-icon blue">
                        <i class="fas fa-book"></i>
                    </div>
                </div>
                <div class="stat-value" id="enrolledCount">0</div>
                <div class="stat-label">Total courses</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-title">Completed</div>
                    <div class="stat-icon green">
                        <i class="fas fa-check-circle"></i>
                    </div>
                </div>
                <div class="stat-value" id="completedCount">0</div>
                <div class="stat-label">Courses finished</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-title">In Progress</div>
                    <div class="stat-icon orange">
                        <i class="fas fa-spinner"></i>
                    </div>
                </div>
                <div class="stat-value" id="inProgressCount">0</div>
                <div class="stat-label">Currently learning</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-title">Certificates</div>
                    <div class="stat-icon purple">
                        <i class="fas fa-certificate"></i>
                    </div>
                </div>
                <div class="stat-value" id="certificatesCount">0</div>
                <div class="stat-label">Earned certificates</div>
            </div>
        </div>

        <!-- TAB: ALL COURSES -->
        <div class="tab-content active" id="tab-all">
            <div class="course-grid" id="allCoursesGrid">
                <!-- Loading state -->
                <p style="grid-column: 1/-1; text-align:center; padding:40px; color:#666;">
                    <i class="fas fa-spinner fa-spin"></i> Loading your courses...
                </p>
            </div>
        </div>

        <!-- TAB: IN PROGRESS -->
        <div class="tab-content" id="tab-in-progress">
            <div class="course-grid" id="inProgressGrid">
                <!-- Courses will be loaded here -->
            </div>
        </div>

        <!-- TAB: COMPLETED -->
        <div class="tab-content" id="tab-completed">
            <div class="course-grid" id="completedGrid">
                <!-- Courses will be loaded here -->
            </div>
        </div>

        <!-- TAB: EXAMS -->
        <div class="tab-content" id="tab-exams">
            <div id="examsContainer" style="max-width:1200px;margin:0 auto">
                <p style="text-align:center; padding:40px; color:#666;">
                    <i class="fas fa-spinner fa-spin"></i> Loading exams...
                </p>
            </div>
        </div>

        <!-- TAB: LIVE SESSIONS -->
        <div class="tab-content" id="tab-live-sessions">
            <div id="liveSessionsContainer">
                <p style="text-align:center; padding:40px; color:#666;">
                    <i class="fas fa-spinner fa-spin"></i> Loading live sessions...
                </p>
            </div>
        </div>

        <!-- TAB: MY RESULTS -->
        <div class="tab-content" id="tab-results">
            <div id="resultsContainer">
                <p style="text-align:center; padding:40px; color:#666;">
                    <i class="fas fa-spinner fa-spin"></i> Loading results...
                </p>
            </div>
        </div>

        <!-- TAB: CERTIFICATES -->
        <div class="tab-content" id="tab-certificates">
            <div id="certificatesContainer">
                <p style="text-align:center; padding:40px; color:#666;">
                    <i class="fas fa-spinner fa-spin"></i> Loading certificates...
                </p>
            </div>
        </div>

        <!-- TAB: WISHLIST -->
        <div class="tab-content" id="tab-wishlist">
            <div class="empty-state">
                <i class="far fa-heart"></i>
                <h3>Your wishlist is empty</h3>
                <p>Save courses you're interested in to access them later</p>
                <a href="/" class="btn btn-primary">Explore Courses</a>
            </div>
        </div>

        <!-- RECOMMENDATIONS -->
        <div class="recommendations" id="recommendations" style="display:none;">
            <h2><i class="fas fa-magic"></i> Recommended for You</h2>
            <p>Based on your learning interests and progress</p>
            <div class="recommendation-list" id="recommendationList">
                <!-- Recommendations will be loaded here -->
            </div>
        </div>
    </main>

    <!-- SCRIPTS -->
    <script>
        const API_BASE = window.location.origin + '/api';
        let allEnrollments = [];
        let currentTab = 'all';

        // Check authentication
        const token = localStorage.getItem('token');
        const user = localStorage.getItem('user');

        if (!token || !user) {
            alert('Please login to access the student dashboard');
            window.location.href = '/';
        }

        const userData = JSON.parse(user);
        if (userData.role !== 'student') {
            // Redirect to appropriate dashboard
            if (userData.role === 'instructor') {
                window.location.href = '/instructor/dashboard';
            } else if (userData.role === 'admin') {
                window.location.href = '/admin/dashboard';
            } else {
                window.location.href = '/';
            }
        }

        // Set user information
        document.getElementById('userInitial').textContent = userData.name.charAt(0).toUpperCase();
        document.getElementById('userName').textContent = userData.name;

        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                localStorage.removeItem('auth_token');
                localStorage.removeItem('user_data');
                window.location.href = '/';
            }
        }

        // Sidebar toggle for mobile
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            sidebar.classList.toggle('mobile-open');
            sidebar.classList.toggle('collapsed');
            overlay.classList.toggle('active');
        }

        // Tab switching with sidebar navigation
        function switchTab(tabName) {
            currentTab = tabName;
            
            // Update sidebar nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`tab-${tabName}`).classList.add('active');

            // Load content
            if (tabName === 'live-sessions') {
                loadLiveSessions();
            } else if (tabName === 'exams') {
                loadExams();
            } else if (tabName === 'results') {
                loadResults();
            } else if (tabName === 'certificates') {
                loadCertificates();
            } else {
                renderCourses(tabName);
            }

            // Close mobile sidebar after selection
            if (window.innerWidth <= 1024) {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebarOverlay');
                sidebar.classList.remove('mobile-open');
                overlay.classList.remove('active');
            }
        }

        // Load enrolled courses
        async function loadEnrollments() {
            try {
                const response = await fetch(`${API_BASE}/student/enrollments`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const data = await response.json();

                if (data.success && data.enrollments) {
                    allEnrollments = data.enrollments;
                    updateStats();
                    renderCourses('all');
                    loadRecommendations();
                    // Pre-load live sessions so they're ready when tab is clicked
                    if (allEnrollments.length > 0) {
                        loadLiveSessions();
                    }
                } else {
                    showEmptyState('all');
                }
            } catch (error) {
                console.error('Error loading enrollments:', error);
                showEmptyState('all');
            }
        }

        // Update statistics
        async function updateStats() {
            const token = localStorage.getItem('token');
            try {
                // Calculate stats from enrollments
                const completed = allEnrollments.filter(e => e.progress >= 100).length;
                const inProgress = allEnrollments.filter(e => e.progress > 0 && e.progress < 100).length;

                document.getElementById('enrolledCount').textContent = allEnrollments.length;
                document.getElementById('completedCount').textContent = completed;
                document.getElementById('inProgressCount').textContent = inProgress;

                // Fetch certificates count from API
                try {
                    const certRes = await fetch(`${API_BASE}/student/certificates`, { headers: { 'Authorization': `Bearer ${token}` } });
                    if (certRes.ok) {
                        const certData = await certRes.json();
                        const count = Array.isArray(certData) ? certData.length : (certData.total || 0);
                        document.getElementById('certificatesCount').textContent = count;
                    } else {
                        // Fallback to completed count if certificates endpoint not available
                        document.getElementById('certificatesCount').textContent = completed;
                    }
                } catch (certErr) {
                    console.log('Certificate count not available, using completed count');
                    document.getElementById('certificatesCount').textContent = completed;
                }
            } catch (err) {
                console.error('updateStats error', err);
            }
        }

        // Render courses
        function renderCourses(filter) {
            const gridId = filter === 'in-progress' ? 'inProgressGrid' : filter === 'completed' ? 'completedGrid' : 'allCoursesGrid';
            const container = document.getElementById(gridId);
            container.innerHTML = '';

            // Build a list of courses from enrollments based on filter
            let list = allEnrollments.map(e => ({ enrollment: e, course: e.course }));
            if (filter === 'in-progress') {
                list = list.filter(i => i.enrollment.progress > 0 && i.enrollment.progress < 100);
            } else if (filter === 'completed') {
                list = list.filter(i => i.enrollment.progress >= 100);
            }

            if (list.length === 0) {
                container.innerHTML = '<p style="grid-column:1/-1;text-align:center;color:#666;padding:40px;">No courses found</p>';
                return;
            }

            list.forEach(item => {
                const course = item.course;
                const enrollment = item.enrollment;
                // Prefer a local static thumbnail at /static/course_images/<slug>.jpg
                function slugify(text) {
                    return String(text).toLowerCase().trim().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
                }
                const seed = encodeURIComponent(course._id || course.title || 'course');
                const localSrc = '/static/course_images/' + slugify(course.title || course._id || 'course') + '.jpg';
                // Use explicit course.thumbnail first, then local static image, then fallback to picsum
                const imgSrc = course.thumbnail || localSrc || `https://picsum.photos/seed/${seed}/600/320`;
                const instructorName = course.instructor_name || (course.instructor && course.instructor.name) || 'Instructor';
                const avatar = `https://ui-avatars.com/api/?name=${encodeURIComponent(instructorName)}&background=0D47A1&color=fff&size=64`;
                const progress = enrollment.progress || 0;

                const card = document.createElement('div');
                card.className = 'course-card';
                card.innerHTML = `
                    <img class="course-image" src="${imgSrc}" alt="${course.title}" onerror="if (!this._triedFallback){this._triedFallback=true;this.src='https://picsum.photos/600/320?random=' + Math.floor(Math.random()*10000);} else {this.src='https://via.placeholder.com/600x320/667eea/ffffff?text=${encodeURIComponent(course.title)}';}">
                    <div style="padding:16px;">
                        <div class="course-meta-row">
                            <div class="instructor-avatar"><img src="${avatar}" style="width:100%;height:100%;object-fit:cover;" onerror="this.src='https://via.placeholder.com/64/0D47A1/ffffff?text=${instructorName.charAt(0)}'"/></div>
                            <div style="flex:1">
                                <div class="course-title">${course.title}</div>
                                <div style="font-size:13px;color:#6b7280">${instructorName} • ${course.duration || 'Self-paced'}</div>
                            </div>
                            <div>
                                <span class="badge">${course.price && course.price > 0 ? '$' + (course.price) : 'FREE'}</span>
                            </div>
                        </div>
                        <div style="color:#666;font-size:14px;margin:12px 0 14px;">${course.short_description || ''}</div>
                        <div class="progress-container">
                            <div class="progress-text">
                                <span>Progress</span>
                                <span><strong>${progress}%</strong></span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                        </div>
                        <div style="display:flex;gap:10px;align-items:center;margin-top:16px;">
                            ${progress >= 100 ? '<a class="btn btn-primary" href="/certificate/' + enrollment._id + '">View Certificate</a>' : '<a class="btn btn-primary" href="/course/learn?course_id=' + course._id + '">Continue</a>'}
                            <a class="btn btn-outline" href="/course/${course._id}">Details</a>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Show empty state
        function showEmptyState(tabId) {
            const grid = document.getElementById(tabId === 'all' ? 'allCoursesGrid' : tabId + 'Grid');
            grid.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-book-open"></i>
                    <h3>No courses enrolled yet</h3>
                    <p>Start your learning journey by exploring our course catalog</p>
                    <a href="/" class="btn btn-primary">Browse Courses</a>
                </div>
            `;
        }

        // Load recommendations
        async function loadRecommendations() {
            try {
                const response = await fetch(`${API_BASE}/student/courses?page=1&per_page=5`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const data = await response.json();

                if (data.success && data.courses && data.courses.length > 0) {
                    document.getElementById('recommendations').style.display = 'block';
                    const list = document.getElementById('recommendationList');
                    list.innerHTML = '';

                    data.courses.slice(0, 5).forEach(course => {
                        const card = document.createElement('div');
                        card.className = 'recommendation-card';
                        card.onclick = () => viewCourse(course._id);
                        
                        card.innerHTML = `
                            <h3>${course.title}</h3>
                            <p class="course-meta">
                                <i class="fas fa-user"></i> ${course.instructor_name || 'LearnHub'} • 
                                <i class="fas fa-star" style="color:#ffa927"></i> ${course.rating || '4.8'}
                            </p>
                            <button class="btn btn-primary btn-sm">
                                ${course.price > 0 ? '$' + course.price : 'Enroll for Free'}
                            </button>
                        `;
                        
                        list.appendChild(card);
                    });
                }
            } catch (error) {
                console.error('Error loading recommendations:', error);
            }
        }

        // Continue learning - redirect to course learning page
        function continueLearning(courseId) {
            window.location.href = `/course/learn?course_id=${courseId}`;
        }

        // View course exams
        async function viewCourseExams(courseId, courseTitle) {
            try {
                // Fetch exams
                const examResponse = await fetch(`/api/student/courses/${courseId}/exams`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const examData = await examResponse.json();

                if (!examResponse.ok || !examData.success) {
                    alert('❌ ' + (examData.message || 'Failed to load exams'));
                    return;
                }

                const exams = examData.exams || [];

                if (exams.length === 0) {
                    alert(`ℹ️ No exams available for "${courseTitle}" yet.\n\nYour instructor hasn't created any exams for this course.`);
                    return;
                }

                // Fetch submissions to check which exams are completed
                const submissionResponse = await fetch('/api/student/submissions', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const submissionData = await submissionResponse.json();
                const submissions = submissionData.submissions || [];
                
                // Create a map of exam_id to submission
                const submissionMap = {};
                submissions.forEach(sub => {
                    submissionMap[sub.exam_id] = sub;
                });

                // Show exams list with submission status
                showExamsList(courseId, courseTitle, exams, submissionMap);

            } catch (error) {
                console.error('Error loading exams:', error);
                alert('❌ Error loading exams: ' + error.message);
            }
        }

        // Show exams list modal
        function showExamsList(courseId, courseTitle, exams, submissionMap) {
            const modalHtml = `
                <div id="examsModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 12px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                        <div style="padding: 24px; border-bottom: 2px solid #e0e0e0; display: flex; justify-content: space-between; align-items: center;">
                            <h2 style="margin: 0; color: #333;">
                                <i class="fas fa-file-alt" style="color: #ff6b6b;"></i>
                                Available Exams
                            </h2>
                            <button onclick="closeExamsModal()" style="background: none; border: none; font-size: 28px; color: #999; cursor: pointer; padding: 0; width: 32px; height: 32px;">&times;</button>
                        </div>
                        <div style="padding: 24px;">
                            <p style="color: #666; margin-bottom: 20px;">Course: <strong>${courseTitle}</strong></p>
                            ${exams.map(exam => {
                                const submission = submissionMap[exam._id] || null;
                                let examDate = '';
                                let deadline = '';
                                
                                try {
                                    if (exam.exam_date) {
                                        const date = new Date(exam.exam_date);
                                        if (!isNaN(date.getTime())) {
                                            examDate = date.toLocaleString('en-IN', { 
                                                dateStyle: 'medium', 
                                                timeStyle: 'short' 
                                            });
                                        }
                                    }
                                } catch (e) {
                                    console.error('Error parsing exam date:', e);
                                }
                                
                                try {
                                    if (exam.deadline) {
                                        const date = new Date(exam.deadline);
                                        if (!isNaN(date.getTime())) {
                                            deadline = date.toLocaleString('en-IN', { 
                                                dateStyle: 'medium', 
                                                timeStyle: 'short' 
                                            });
                                        }
                                    }
                                } catch (e) {
                                    console.error('Error parsing deadline:', e);
                                }
                                
                                return `
                                <div style="border: 2px solid #e0e0e0; border-radius: 8px; padding: 16px; margin-bottom: 12px; transition: all 0.3s;">
                                    <h3 style="margin: 0 0 8px 0; color: #333;">${exam.title}</h3>
                                    ${exam.description ? `<p style="color: #666; font-size: 14px; margin-bottom: 12px;">${exam.description}</p>` : ''}
                                    <div style="display: flex; gap: 20px; flex-wrap: wrap; font-size: 14px; color: #666; margin-bottom: 12px;">
                                        ${examDate ? `<div><i class="fas fa-calendar-day"></i> ${examDate}</div>` : ''}
                                        ${deadline ? `<div><i class="fas fa-calendar-times"></i> Deadline: ${deadline}</div>` : ''}
                                        <div><i class="fas fa-clock"></i> ${exam.duration_minutes} minutes</div>
                                        <div><i class="fas fa-star"></i> ${exam.total_marks} marks</div>
                                        <div><i class="fas fa-check-circle"></i> Pass: ${exam.passing_marks} marks (${exam.passing_score_percent}%)</div>
                                    </div>
                                    ${submission ? `
                                        <div style="background: ${submission.passed ? '#d4edda' : '#f8d7da'}; border: 2px solid ${submission.passed ? '#28a745' : '#dc3545'}; border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                                <div>
                                                    <strong style="color: ${submission.passed ? '#155724' : '#721c24'};">
                                                        ${submission.passed ? '✅ PASSED' : '❌ FAILED'}
                                                    </strong>
                                                    <div style="font-size: 14px; color: #666; margin-top: 4px;">
                                                        Score: ${submission.marks_obtained}/${submission.total_marks} 
                                                        (${((submission.marks_obtained/submission.total_marks)*100).toFixed(1)}%)
                                                    </div>
                                                </div>
                                                ${submission.certificate_issued ? `
                                                    <button onclick="viewCertificate('${submission._id}')" 
                                                            style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 6px; font-weight: 600; cursor: pointer;">
                                                        <i class="fas fa-certificate"></i> Certificate
                                                    </button>
                                                ` : ''}
                                            </div>
                                        </div>
                                        <button onclick="viewExamResult('${submission._id}', '${exam.title.replace(/'/g, "\\'")}')" 
                                                style="background: #0056d2; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: 700; cursor: pointer; width: 100%;">
                                            <i class="fas fa-chart-bar"></i> View Results
                                        </button>
                                    ` : `
                                        <button onclick="startExam('${exam._id}', '${exam.title.replace(/'/g, "\\'")}')" 
                                                style="background: #ff6b6b; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: 700; cursor: pointer; width: 100%; transition: all 0.3s;"
                                                onmouseover="this.style.background='#ff5252'"
                                                onmouseout="this.style.background='#ff6b6b'">
                                            <i class="fas fa-play"></i> Start Exam
                                        </button>
                                    `}
                                </div>
                            `}).join('')}
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        // Close exams modal
        function closeExamsModal() {
            const modal = document.getElementById('examsModal');
            if (modal) {
                modal.remove();
            }
        }

        // Start exam
        function startExam(examId, examTitle) {
            if (confirm(`Start "${examTitle}"?\n\nOnce you start, the timer will begin. Make sure you have enough time to complete the exam.`)) {
                window.location.href = `/exam/${examId}/take`;
            }
        }

        // View exam result
        async function viewExamResult(submissionId, examTitle) {
            try {
                const response = await fetch(`/api/student/submissions/${submissionId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();
                
                if (!response.ok || !data.success) {
                    alert('❌ Failed to load exam results');
                    return;
                }

                const submission = data.submission;
                const percentage = ((submission.marks_obtained / submission.total_marks) * 100).toFixed(1);
                const certMsg = submission.certificate_issued ? '🎓 Certificate has been issued!\n\n' : '';
                const failMsg = !submission.passed ? `Minimum required: ${submission.passing_marks} marks` : '';
                
                alert(`📊 Exam Results: ${examTitle}\n\n` +
                      `Score: ${submission.marks_obtained}/${submission.total_marks} (${percentage}%)\n` +
                      `Status: ${submission.passed ? '✅ PASSED' : '❌ FAILED'}\n` +
                      `Submitted: ${new Date(submission.submitted_at).toLocaleString()}\n\n` +
                      certMsg + failMsg);
                      
            } catch (error) {
                console.error('Error loading result:', error);
                alert('❌ Error loading results');
            }
        }

        // View certificate
        function viewCertificate(submissionId) {
            window.open(`/certificate/${submissionId}`, '_blank');
        }

        // View course
        function viewCourse(courseId) {
            window.location.href = `/course/${courseId}`;
        }

        // View certificate
        function viewCertificate(enrollmentId) {
            window.location.href = `/certificate/${enrollmentId}`;
        }

        // Search courses
        document.getElementById('searchCourses').addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            if (!query) {
                renderCourses(currentTab);
                return;
            }

            const filtered = allEnrollments.filter(enrollment => 
                enrollment.course.title.toLowerCase().includes(query) ||
                (enrollment.course.instructor_name && enrollment.course.instructor_name.toLowerCase().includes(query))
            );

            const gridId = currentTab === 'all' ? 'allCoursesGrid' : currentTab === 'in-progress' ? 'inProgressGrid' : 'completedGrid';
            const grid = document.getElementById(gridId);
            grid.innerHTML = '';

            if (filtered.length === 0) {
                grid.innerHTML = '<p style="text-align:center; padding:40px; color:#666;">No courses found</p>';
                return;
            }

            filtered.forEach(enrollment => {
                const course = enrollment.course;
                const card = document.createElement('div');
                card.className = 'course-card';
                
                card.innerHTML = `
                    <img class="course-image" src="${course.thumbnail || 'https://source.unsplash.com/400x200/?course,education'}" alt="${course.title}">
                    <div class="course-body">
                        <h3 class="course-title">${course.title}</h3>
                        <p class="course-instructor">By ${course.instructor_name || 'LearnHub Instructor'}</p>
                        
                        <div class="progress-container">
                            <div class="progress-text">
                                <span>Progress</span>
                                <span><strong>${enrollment.progress || 0}%</strong></span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${enrollment.progress || 0}%"></div>
                            </div>
                        </div>

                        <div class="course-actions">
                            ${enrollment.progress >= 100 
                                ? '<button class="btn btn-primary" onclick="viewCertificate(\'' + enrollment._id + '\')"><i class="fas fa-certificate"></i> View Certificate</button>'
                                : '<button class="btn btn-primary" onclick="continueLearning(\'' + course._id + '\')">Continue Learning</button>'
                            }
                            <button class="btn btn-outline" onclick="viewCourseExams('${course._id}', '${course.title.replace(/'/g, "\\'")}')">
                                <i class="fas fa-file-alt"></i> Exam
                            </button>
                            <button class="btn btn-outline" onclick="viewCourse('${course._id}')">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        });

        // Load live sessions for enrolled courses
        async function loadLiveSessions() {
            const container = document.getElementById('liveSessionsContainer');
            
            // Check if enrollments are loaded
            if (!allEnrollments || allEnrollments.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-video-slash" style="font-size:64px;color:#e0e0e0;margin-bottom:20px"></i>
                        <h3>No Enrolled Courses</h3>
                        <p>Enroll in courses to see their live sessions here!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '<p style="text-align:center; padding:40px; color:#666;"><i class="fas fa-spinner fa-spin"></i> Loading live sessions...</p>';

            try {
                // Get all live sessions for enrolled courses
                const courseIds = allEnrollments.map(e => e.course._id);
                console.log('Loading live sessions for courses:', courseIds);
                const allSessions = [];

                for (const courseId of courseIds) {
                    try {
                        const res = await fetch(`${API_BASE}/student/courses/${courseId}/liveclasses`, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        const data = await res.json();
                        console.log(`Live classes for course ${courseId}:`, data);
                        
                        if (data.success && data.live_classes) {
                            // Add course info to each session
                            const course = allEnrollments.find(e => e.course._id === courseId)?.course;
                            data.live_classes.forEach(session => {
                                session.course_info = course;
                                allSessions.push(session);
                            });
                        }
                    } catch (err) {
                        console.error(`Error loading sessions for course ${courseId}:`, err);
                    }
                }

                // Sort by date
                allSessions.sort((a, b) => new Date(a.starts_at) - new Date(b.starts_at));
                
                console.log(`Total live sessions found: ${allSessions.length}`);

                if (allSessions.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-video-slash" style="font-size:64px;color:#e0e0e0;margin-bottom:20px"></i>
                            <h3>No Live Sessions Scheduled</h3>
                            <p>Your instructors haven't scheduled any live sessions yet. Check back later!</p>
                        </div>
                    `;
                    return;
                }

                const now = new Date();
                container.innerHTML = allSessions.map(session => {
                    const startsAt = new Date(session.starts_at);
                    // Force all live sessions to be available (ignore dates, per request)
                    let isUpcoming = false;
                    let isPast = false;
                    
                    // Calculate time difference
                    const diffMs = startsAt - now;
                    const diffMins = Math.floor(diffMs / 60000);
                    const diffHours = Math.floor(diffMins / 60);
                    const diffDays = Math.floor(diffHours / 24);
                    
                    let badgeClass = 'live';
                    let badgeText = 'LIVE NOW';
                    let cardClass = 'live-now';
                    let timeIndicator = '<div class="time-indicator live">🔴 LIVE NOW - Join immediately!</div>';
                    
                    if (!isPast) {
                        if (diffMins < 60) {
                            badgeClass = 'live';
                            badgeText = diffMins > 0 ? `STARTS IN ${diffMins} MIN` : 'LIVE NOW';
                            cardClass = 'live-now';
                            timeIndicator = `<div class="time-indicator ${diffMins < 15 ? 'urgent' : 'live'}">
                                ${diffMins > 0 ? `⚡ Starting in ${diffMins} minute${diffMins > 1 ? 's' : ''}!` : '🔴 LIVE NOW - Join immediately!'}
                            </div>`;
                        } else if (diffHours < 24) {
                            timeIndicator = `<div class="time-indicator soon">📅 Starts in ${diffHours} hour${diffHours > 1 ? 's' : ''}</div>`;
                        } else if (diffDays < 7) {
                            timeIndicator = `<div class="time-indicator soon">📅 Starts in ${diffDays} day${diffDays > 1 ? 's' : ''}</div>`;
                        }
                    }
                    
                    const dateStr = startsAt.toLocaleDateString('en-US', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    const timeStr = startsAt.toLocaleTimeString('en-US', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    const platformIcon = session.meeting_type === 'zoom' ? 'video' : 
                                        session.meeting_type === 'meet' ? 'google' : 
                                        session.meeting_type === 'teams' ? 'microsoft' : 'link';
                    const platformName = session.meeting_type === 'meet' ? 'Google Meet' : 
                                        session.meeting_type === 'zoom' ? 'Zoom' : 
                                        session.meeting_type === 'teams' ? 'Microsoft Teams' : 'Custom Link';
                    
                    return `
                        <div class="live-session-card ${cardClass}">
                            <span class="session-badge ${badgeClass}">${badgeText}</span>
                            
                            <div class="live-session-header">
                                <img src="${session.course_info?.thumbnail || 'https://source.unsplash.com/200x200/?course'}" 
                                     alt="${session.course_info?.title || 'Course'}" 
                                     class="session-course-thumb">
                                <div class="session-info">
                                    <div class="session-course-title">${session.course_info?.title || 'Course'}</div>
                                    <div class="session-title">
                                        <i class="fas fa-video"></i>
                                        ${session.title || 'Live Session'}
                                    </div>
                                </div>
                            </div>
                            
                            ${timeIndicator}
                            
                            <div class="session-meta">
                                <div class="meta-item">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>${dateStr}</span>
                                </div>
                                <div class="meta-item">
                                    <i class="fas fa-clock"></i>
                                    <span>${timeStr} (${session.duration_minutes || 60} min)</span>
                                </div>
                                <div class="meta-item">
                                    <i class="fas fa-${platformIcon}"></i>
                                    <span>${platformName}</span>
                                </div>
                            </div>
                            
                            <div class="session-actions">
                                ${session.meeting_link ? `
                                    <a href="${session.meeting_link}" 
                                       target="_blank" 
                                       class="btn-join-session">
                                        <i class="fas fa-external-link-alt"></i>
                                        Join Now
                                    </a>
                                ` : `
                                    <a href="#" class="btn-join-session" onclick="alert('Meeting link not provided by instructor yet.')">
                                        <i class="fas fa-external-link-alt"></i>
                                        Join Now
                                    </a>
                                `}
                            </div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('Error loading live sessions:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle" style="font-size:64px;color:#ff6b6b;margin-bottom:20px"></i>
                        <h3>Unable to Load Live Sessions</h3>
                        <p>Please try refreshing the page.</p>
                    </div>
                `;
            }
        }

        // Load exams for enrolled courses
        async function loadExams() {
            const container = document.getElementById('examsContainer');
            container.innerHTML = '<p style="text-align:center; padding:40px; color:#666;"><i class="fas fa-spinner fa-spin"></i> Loading exams...</p>';

            try {
                const res = await fetch(`${API_BASE}/student/exams`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();
                console.log('Exams loaded:', data);
                
                if (!data.success || !data.exams || data.exams.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-clipboard-list" style="font-size:64px;color:#e0e0e0;margin-bottom:20px"></i>
                            <h3>No Exams Available</h3>
                            <p>Your instructors haven't scheduled any exams yet.</p>
                        </div>
                    `;
                    return;
                }

                const exams = data.exams;
                const now = new Date();
                
                container.innerHTML = `
                    <div style="display:grid;gap:20px">
                        ${exams.map(exam => {
                            // Parse dates safely
                            const startDate = exam.exam_date ? new Date(exam.exam_date) : null;
                            const deadline = exam.deadline ? new Date(exam.deadline) : null;
                            
                            // Debug logging
                            console.log('Exam:', exam.title);
                            console.log('Start Date:', startDate, 'Valid:', startDate && !isNaN(startDate.getTime()));
                            console.log('Deadline:', deadline, 'Valid:', deadline && !isNaN(deadline.getTime()));
                            console.log('Now:', now);
                            
                            // Check if dates are valid (both present) or if any date is present
                            const hasValidDates = startDate && deadline && !isNaN(startDate.getTime()) && !isNaN(deadline.getTime());
                            const hasAnyDate = (startDate && !isNaN(startDate.getTime())) || (deadline && !isNaN(deadline.getTime()));

                            let isAvailable = false;
                            let isPast = false;
                            let isUpcoming = false;

                            // Per requested behavior: ignore all dates and treat every exam as available now
                            isAvailable = true;
                            isPast = false;
                            isUpcoming = false;
                            console.log('All exams forced AVAILABLE NOW (dates ignored)');
                            
                            let statusBadge = '';
                            let statusClass = '';
                            // Always show AVAILABLE NOW and do not show UPCOMING or CLOSED badges
                            statusBadge = '<span style="background:#00a854;color:#fff;padding:6px 12px;border-radius:4px;font-size:12px;font-weight:600;animation:pulse 2s infinite">AVAILABLE NOW</span>';
                            statusClass = 'border-left:4px solid #00a854';
                            
                            return `
                                <div style="background:#fff;border:2px solid #e0e0e0;border-radius:12px;padding:24px;${statusClass}">
                                    <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:16px">
                                        <div>
                                            <h3 style="margin:0 0 8px 0;color:#1f1f1f">${exam.title}</h3>
                                            <p style="margin:0;color:#666;font-size:14px">${exam.description || 'No description'}</p>
                                        </div>
                                        ${statusBadge}
                                    </div>
                                    
                                    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:16px">
                                        <div style="display:flex;align-items:center;gap:8px;color:#666">
                                            <i class="fas fa-calendar-alt" style="color:#0056d2"></i>
                                            <div>
                                                <div style="font-size:12px;color:#999">Start</div>
                                                <div style="font-size:14px;font-weight:600">${now.toLocaleDateString() + ' ' + now.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</div>
                                            </div>
                                        </div>
                                        <div style="display:flex;align-items:center;gap:8px;color:#666">
                                            <i class="fas fa-clock" style="color:#ff9800"></i>
                                            <div>
                                                <div style="font-size:12px;color:#999">Duration</div>
                                                <div style="font-size:14px;font-weight:600">${exam.duration_minutes} minutes</div>
                                            </div>
                                        </div>
                                        <div style="display:flex;align-items:center;gap:8px;color:#666">
                                            <i class="fas fa-star" style="color:#ffc107"></i>
                                            <div>
                                                <div style="font-size:12px;color:#999">Total Marks</div>
                                                <div style="font-size:14px;font-weight:600">${exam.total_marks} marks</div>
                                            </div>
                                        </div>
                                        <div style="display:flex;align-items:center;gap:8px;color:#666">
                                            <i class="fas fa-tasks" style="color:#00a854"></i>
                                            <div>
                                                <div style="font-size:12px;color:#999">Questions</div>
                                                <div style="font-size:14px;font-weight:600">10 MCQs</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div style="display:flex;gap:12px;justify-content:flex-end">
                                        ${isAvailable ? `
                                            <button onclick="startExam('${exam._id}')" style="padding:12px 24px;background:#0056d2;color:#fff;border:none;border-radius:6px;font-weight:600;cursor:pointer">
                                                <i class="fas fa-play"></i> Start Exam
                                            </button>
                                        ` : isPast ? `
                                            <button onclick="viewExamResults('${exam._id}')" style="padding:12px 24px;background:#666;color:#fff;border:none;border-radius:6px;font-weight:600;cursor:pointer">
                                                <i class="fas fa-chart-bar"></i> View Results
                                            </button>
                                        ` : `
                                            <button disabled style="padding:12px 24px;background:#e0e0e0;color:#999;border:none;border-radius:6px;font-weight:600;cursor:not-allowed">
                                                Available on ${hasValidDates && startDate ? startDate.toLocaleDateString() : 'TBD'}
                                            </button>
                                        `}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            } catch (error) {
                console.error('Error loading exams:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle" style="font-size:64px;color:#ff6b6b;margin-bottom:20px"></i>
                        <h3>Unable to Load Exams</h3>
                        <p>Please try refreshing the page.</p>
                    </div>
                `;
            }
        }
        
        function startExam(examId) {
            // Redirect to exam taking page
            window.location.href = `/student/exam?id=${examId}`;
        }
        
        function viewExamResults(examId) {
            alert('Results viewing feature coming soon!');
        }

        // Load student exam results
        async function loadResults() {
            const container = document.getElementById('resultsContainer');
            container.innerHTML = '<p style="text-align:center;padding:40px;color:#666"><i class="fas fa-spinner fa-spin"></i> Loading results...</p>';

            try {
                const res = await fetch(`${API_BASE}/student/submissions`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();
                
                if (!data.success || !data.submissions || data.submissions.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-chart-line" style="font-size:64px;color:#999;margin-bottom:20px"></i>
                            <h3>No Exam Results Yet</h3>
                            <p>Your exam results will appear here after you complete exams</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = `
                    <div style="max-width:1200px;margin:0 auto">
                        <h2 style="margin-bottom:24px;color:#1f1f1f"><i class="fas fa-chart-bar" style="color:#0056d2"></i> My Exam Results</h2>
                        <div style="display:grid;gap:20px">
                            ${data.submissions.map(sub => `
                                <div style="background:#fff;border:1px solid #e0e0e0;border-radius:12px;padding:24px;">
                                    <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:16px">
                                        <div>
                                            <h3 style="margin:0 0 8px 0;color:#1f1f1f">${sub.exam_title || 'Exam'}</h3>
                                            <p style="margin:0;color:#666;font-size:14px">Submitted: ${new Date(sub.submitted_at).toLocaleString()}</p>
                                        </div>
                                        <span style="padding:8px 16px;border-radius:20px;font-size:14px;font-weight:600;background:${sub.passed ? '#e6f7ed' : '#ffe6e6'};color:${sub.passed ? '#00a854' : '#ff6b6b'}">
                                            ${sub.passed ? '✓ PASSED' : '✗ FAILED'}
                                        </span>
                                    </div>
                                    
                                    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;padding:20px;background:#f7f9fa;border-radius:8px">
                                        <div>
                                            <div style="font-size:12px;color:#999;margin-bottom:4px">Your Score</div>
                                            <div style="font-size:28px;font-weight:700;color:${sub.passed ? '#00a854' : '#ff6b6b'}">${sub.marks_obtained}/${sub.total_marks}</div>
                                        </div>
                                        <div>
                                            <div style="font-size:12px;color:#999;margin-bottom:4px">Percentage</div>
                                            <div style="font-size:28px;font-weight:700;color:#0056d2">${Math.round((sub.marks_obtained/sub.total_marks)*100)}%</div>
                                        </div>
                                        <div>
                                            <div style="font-size:12px;color:#999;margin-bottom:4px">Passing Marks</div>
                                            <div style="font-size:28px;font-weight:700;color:#666">${sub.passing_marks}</div>
                                        </div>
                                    </div>

                                    ${sub.passed ? `
                                        <div style="margin-top:16px;padding:12px;background:#e6f7ed;border-left:4px solid #00a854;border-radius:4px">
                                            <p style="margin:0;color:#00a854;font-weight:600"><i class="fas fa-certificate"></i> Congratulations! You passed this exam</p>
                                        </div>
                                    ` : `
                                        <div style="margin-top:16px;padding:12px;background:#fff3cd;border-left:4px solid #ffc107;border-radius:4px">
                                            <p style="margin:0;color:#856404"><i class="fas fa-info-circle"></i> You need at least ${sub.passing_marks} marks to pass</p>
                                        </div>
                                    `}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading results:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle" style="font-size:64px;color:#ff6b6b;margin-bottom:20px"></i>
                        <h3>Unable to Load Results</h3>
                        <p>Please try refreshing the page</p>
                    </div>
                `;
            }
        }

        // Load student certificates
        async function loadCertificates() {
            const container = document.getElementById('certificatesContainer');
            container.innerHTML = '<p style="text-align:center;padding:40px;color:#666"><i class="fas fa-spinner fa-spin"></i> Loading certificates...</p>';

            try {
                const res = await fetch(`${API_BASE}/student/certificates`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();
                
                if (!data.success || !data.certificates || data.certificates.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-certificate" style="font-size:64px;color:#999;margin-bottom:20px"></i>
                            <h3>No Certificates Yet</h3>
                            <p>Complete exams and pass to earn certificates</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = `
                    <div style="max-width:1200px;margin:0 auto">
                        <h2 style="margin-bottom:24px;color:#1f1f1f"><i class="fas fa-award" style="color:#ffc107"></i> My Certificates</h2>
                        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:24px">
                            ${data.certificates.map(cert => `
                                <div style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:16px;padding:32px;color:#fff;box-shadow:0 10px 30px rgba(0,0,0,0.2);position:relative;overflow:hidden">
                                    <div style="position:absolute;top:-20px;right:-20px;width:100px;height:100px;background:rgba(255,255,255,0.1);border-radius:50%"></div>
                                    <div style="position:absolute;bottom:-30px;left:-30px;width:120px;height:120px;background:rgba(255,255,255,0.1);border-radius:50%"></div>
                                    
                                    <div style="position:relative;z-index:1">
                                        <div style="text-align:center;margin-bottom:20px">
                                            <i class="fas fa-certificate" style="font-size:48px;margin-bottom:12px;opacity:0.9"></i>
                                            <h3 style="margin:0 0 8px 0;font-size:20px">Certificate of Completion</h3>
                                            <p style="margin:0;font-size:12px;opacity:0.8">ID: ${cert.certificate_id}</p>
                                        </div>
                                        
                                        <div style="background:rgba(255,255,255,0.15);backdrop-filter:blur(10px);border-radius:8px;padding:16px;margin-bottom:16px">
                                            <h4 style="margin:0 0 8px 0;font-size:18px">${cert.course_title}</h4>
                                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;font-size:14px">
                                                <div>
                                                    <div style="opacity:0.8">Score</div>
                                                    <div style="font-weight:700;font-size:16px">${cert.marks_obtained}/${cert.total_marks} (${cert.percentage}%)</div>
                                                </div>
                                                <div>
                                                    <div style="opacity:0.8">Issued</div>
                                                    <div style="font-weight:700;font-size:16px">${new Date(cert.issued_date).toLocaleDateString()}</div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <button onclick="downloadCertificate('${cert._id}')" style="width:100%;padding:12px;background:#fff;color:#667eea;border:none;border-radius:8px;font-weight:700;cursor:pointer;font-size:14px;transition:all 0.3s">
                                            <i class="fas fa-download"></i> Download Certificate
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading certificates:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle" style="font-size:64px;color:#ff6b6b;margin-bottom:20px"></i>
                        <h3>Unable to Load Certificates</h3>
                        <p>Please try refreshing the page</p>
                    </div>
                `;
            }
        }

        async function downloadCertificate(certId) {
            try {
                const res = await fetch(`${API_BASE}/student/certificates/${certId}/download`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!res.ok) {
                    const err = await res.json().catch(() => ({}));
                    alert('Failed to download certificate: ' + (err.error || res.statusText));
                    return;
                }

                const blob = await res.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `certificate_${certId}.pdf`;
                document.body.appendChild(a);
                a.click();
                a.remove();
                window.URL.revokeObjectURL(url);
            } catch (error) {
                console.error('Download error', error);
                alert('Error downloading certificate');
            }
        }

        // Initialize
        loadEnrollments();
    </script>
</body>
</html>
