<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CourseHub | Explore Courses</title>
<style>
/* ======== GLOBAL STYLE ======== */
* {margin:0; padding:0; box-sizing:border-box; font-family:'Poppins',sans-serif;}
body {background:#fff; color:#333; overflow-x:hidden;}
a {text-decoration:none; color:inherit;}
img {max-width:100%; border-radius:8px;}
button {cursor:pointer; border:none; outline:none;}

/* ======== NAVBAR ======== */
header {
  background:#fff;
  display:flex; align-items:center; justify-content:space-between;
  padding:15px 50px; box-shadow:0 2px 5px rgba(0,0,0,0.1);
  position:sticky; top:0; z-index:10;
}
.logo {font-size:1.5rem; font-weight:700; color:#0056d2;}
.nav-links {display:flex; gap:30px; align-items:center;}
.nav-links a {color:#333; font-weight:500; transition:0.3s;}
.nav-links a:hover {color:#0056d2;}
.login-btn {
  background:#0056d2; color:#fff; padding:8px 16px; border-radius:25px;
  transition:0.3s;
}
.login-btn:hover {background:#003c91;}

/* ======== SEARCH BAR ======== */
.search-section {
  background:linear-gradient(135deg,#0056d2,#007bff);
  color:#fff; text-align:center; padding:60px 20px;
}
.search-section h1 {font-size:2.5rem; margin-bottom:10px;}
.search-section input {
  padding:12px 20px; width:40%; border:none; border-radius:25px; outline:none;
  font-size:1rem;
}
.search-section button {
  margin-left:10px; padding:12px 25px; border-radius:25px;
  background:#fff; color:#0056d2; font-weight:600;
  transition:0.3s;
}
.search-section button:hover {background:#e6e6e6;}

/* ======== MAIN CONTENT ======== */
.main-content {
  display:flex; gap:20px; padding:40px 5%;
}
.sidebar {
  flex:1; max-width:250px; background:#f8f9ff;
  padding:20px; border-radius:10px; height:fit-content;
}
.sidebar h3 {color:#0056d2; margin-bottom:10px;}
.sidebar label {display:block; margin:8px 0;}
.sidebar input[type=checkbox] {margin-right:5px;}

/* ======== COURSE GRID ======== */
.course-area {
  flex:3;
}
.sort-bar {
  display:flex; justify-content:space-between; align-items:center;
  margin-bottom:20px;
}
.sort-bar select {
  padding:8px 12px; border-radius:5px; border:1px solid #ccc;
}
.course-grid {
  display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
  gap:25px;
}
.course-card {
  background:#fff; border-radius:10px;
  box-shadow:0 4px 8px rgba(0,0,0,0.1);
  transition:0.3s; overflow:hidden;
}
.course-card:hover {transform:translateY(-5px);}
.course-card img {height:150px; width:100%; object-fit:cover;}
.course-info {padding:15px;}
.course-info h3 {margin-bottom:5px;}
.course-info p {font-size:0.9rem; color:#555;}
.rating {color:#f1c40f;}
.enroll-btn {
  display:inline-block; margin-top:10px; padding:8px 16px;
  background:#0056d2; color:#fff; border-radius:25px;
  transition:0.3s;
}
.enroll-btn:hover {background:#003c91;}

/* ======== LOAD MORE ======== */
.load-more {
  display:block; margin:30px auto; padding:10px 25px;
  background:#0056d2; color:#fff; border-radius:25px;
  transition:0.3s;
}
.load-more:hover {background:#003c91;}

/* ======== FOOTER ======== */
footer {
  background:#003c91; color:#fff; padding:40px 5%; text-align:center; margin-top:40px;
}
footer a {color:#fff; margin:0 10px;}
footer a:hover {text-decoration:underline;}

/* ======== RESPONSIVE ======== */
@media(max-width:768px){
  .main-content{flex-direction:column;}
  .search-section input{width:70%;}
}
</style>
</head>
<body>

<!-- ======== NAVBAR ======== -->
<header>
  <div class="logo">CourseHub</div>
  <nav class="nav-links">
    <a href="/">Home</a>
    <a href="/courses" style="color:#0056d2; font-weight:600;">Courses</a>
    <a href="/about">About</a>
    <a href="/login" class="login-btn" id="authBtn">Join for Free</a>
  </nav>
</header>

<!-- ======== SEARCH BAR ======== -->
<section class="search-section">
  <h1>Explore Top Courses</h1>
  <p>Find the perfect course to upskill and achieve your goals</p>
  <input type="text" id="searchInput" placeholder="Search for courses..." />
  <button onclick="searchCourses()">Search</button>
</section>

<!-- ======== MAIN CONTENT ======== -->
<section class="main-content">
  <!-- SIDEBAR FILTERS -->
  <aside class="sidebar">
    <h3>Filter by Category</h3>
    <label><input type="checkbox" value="AI" onchange="filterCourses()"> AI & Machine Learning</label>
    <label><input type="checkbox" value="Business" onchange="filterCourses()"> Business</label>
    <label><input type="checkbox" value="Design" onchange="filterCourses()"> Design</label>
    <label><input type="checkbox" value="Programming" onchange="filterCourses()"> Programming</label>
    <label><input type="checkbox" value="Web Development" onchange="filterCourses()"> Web Development</label>

    <h3>Price</h3>
    <label><input type="radio" name="price" value="all" checked onchange="filterCourses()"> All</label>
    <label><input type="radio" name="price" value="free" onchange="filterCourses()"> Free</label>
    <label><input type="radio" name="price" value="paid" onchange="filterCourses()"> Paid</label>

    <h3>Level</h3>
    <label><input type="checkbox" value="Beginner" onchange="filterCourses()"> Beginner</label>
    <label><input type="checkbox" value="Intermediate" onchange="filterCourses()"> Intermediate</label>
    <label><input type="checkbox" value="Advanced" onchange="filterCourses()"> Advanced</label>
  </aside>

  <!-- COURSE GRID -->
  <div class="course-area">
    <div class="sort-bar">
      <h2 id="courseCount">Loading courses...</h2>
      <select id="sortSelect" onchange="sortCourses()">
        <option value="popular">Sort by: Most Popular</option>
        <option value="newest">Newest</option>
        <option value="price_low">Price: Low to High</option>
        <option value="price_high">Price: High to Low</option>
      </select>
    </div>
    <div class="course-grid" id="courseGrid">
      <p style="grid-column: 1/-1; text-align:center; padding:20px;">Loading courses...</p>
    </div>
    <button class="load-more" id="loadMoreBtn" style="display:none;" onclick="loadMore()">Load More</button>
  </div>
</section>

<!-- ======== FOOTER ======== -->
<footer>
  <p>© 2025 CourseHub | Learn Anytime, Anywhere</p>
  <p>
    <a href="/about">About</a> | 
    <a href="#">Contact</a> | 
    <a href="#">Privacy</a>
  </p>
</footer>

<script src="/static/js/api-client.js"></script>
<script>
let allCourses = [];
let filteredCourses = [];
let currentPage = 1;
const coursesPerPage = 12;

// Check authentication and update UI
if (api.isAuthenticated()) {
  const user = api.getUser();
  document.getElementById('authBtn').textContent = user.name;
  document.getElementById('authBtn').href = user.role === 'student' ? '/student/dashboard' : 
                                             user.role === 'instructor' ? '/instructor/dashboard' : '/admin/dashboard';
}

// Load courses on page load
async function loadCourses() {
  try {
    const response = await fetch('/api/student/courses?page=1&per_page=100', {
      headers: api.isAuthenticated() ? { 'Authorization': `Bearer ${api.getToken()}` } : {}
    });
    
    const data = await response.json();
    
    if (data.success) {
      allCourses = data.courses || [];
      filteredCourses = [...allCourses];
      displayCourses();
    } else {
      document.getElementById('courseGrid').innerHTML = '<p style="grid-column: 1/-1; text-align:center;">No courses available</p>';
    }
  } catch (error) {
    console.error('Error loading courses:', error);
    document.getElementById('courseGrid').innerHTML = '<p style="grid-column: 1/-1; text-align:center; color:red;">Error loading courses</p>';
  }
}

function displayCourses() {
  const grid = document.getElementById('courseGrid');
  const startIndex = 0;
  const endIndex = currentPage * coursesPerPage;
  const coursesToShow = filteredCourses.slice(startIndex, endIndex);
  
  if (coursesToShow.length === 0) {
    grid.innerHTML = '<p style="grid-column: 1/-1; text-align:center;">No courses found matching your criteria</p>';
    document.getElementById('loadMoreBtn').style.display = 'none';
    return;
  }
  
  grid.innerHTML = '';
  
  coursesToShow.forEach(course => {
    const card = document.createElement('div');
    card.className = 'course-card';
    card.innerHTML = `
      <img src="${course.thumbnail || 'https://source.unsplash.com/400x200/?course,education'}" alt="${course.title}">
      <div class="course-info">
        <h3>${course.title}</h3>
        <p>Level: ${course.level || 'Beginner'} | ⭐ ${course.rating || '4.5'}</p>
        <p style="color:#0056d2; font-weight:600;">$${course.price || '0'}</p>
        <p style="font-size:0.85rem; color:#666;">${course.duration || 'Self-paced'}</p>
        <a href="/course/${course._id}" class="enroll-btn">View Details</a>
      </div>
    `;
    grid.appendChild(card);
  });
  
  document.getElementById('courseCount').textContent = `${filteredCourses.length} Courses Found`;
  
  // Show/hide load more button
  if (endIndex < filteredCourses.length) {
    document.getElementById('loadMoreBtn').style.display = 'block';
  } else {
    document.getElementById('loadMoreBtn').style.display = 'none';
  }
}

function searchCourses() {
  const searchTerm = document.getElementById('searchInput').value.toLowerCase();
  
  if (searchTerm.trim()) {
    filteredCourses = allCourses.filter(course => 
      course.title.toLowerCase().includes(searchTerm) ||
      course.description.toLowerCase().includes(searchTerm) ||
      (course.tags && course.tags.some(tag => tag.toLowerCase().includes(searchTerm)))
    );
  } else {
    filteredCourses = [...allCourses];
  }
  
  currentPage = 1;
  displayCourses();
}

// Add search on Enter key
document.getElementById('searchInput').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    searchCourses();
  }
});

function filterCourses() {
  // Get selected categories
  const categoryCheckboxes = document.querySelectorAll('.sidebar input[type="checkbox"]:not([name])');
  const selectedCategories = Array.from(categoryCheckboxes)
    .filter(cb => cb.checked)
    .map(cb => cb.value);
  
  // Get selected price filter
  const priceFilter = document.querySelector('.sidebar input[name="price"]:checked').value;
  
  // Get selected levels
  const levelCheckboxes = document.querySelectorAll('.sidebar input[type="checkbox"][value="Beginner"], .sidebar input[type="checkbox"][value="Intermediate"], .sidebar input[type="checkbox"][value="Advanced"]');
  const selectedLevels = Array.from(levelCheckboxes)
    .filter(cb => cb.checked)
    .map(cb => cb.value);
  
  // Filter courses
  filteredCourses = allCourses.filter(course => {
    // Category filter
    if (selectedCategories.length > 0) {
      const hasCategory = course.tags && course.tags.some(tag => 
        selectedCategories.some(cat => tag.toLowerCase().includes(cat.toLowerCase()))
      );
      if (!hasCategory) return false;
    }
    
    // Price filter
    if (priceFilter === 'free' && course.price > 0) return false;
    if (priceFilter === 'paid' && course.price === 0) return false;
    
    // Level filter
    if (selectedLevels.length > 0 && !selectedLevels.includes(course.level)) {
      return false;
    }
    
    return true;
  });
  
  currentPage = 1;
  displayCourses();
}

function sortCourses() {
  const sortValue = document.getElementById('sortSelect').value;
  
  switch(sortValue) {
    case 'popular':
      filteredCourses.sort((a, b) => (b.total_enrollments || 0) - (a.total_enrollments || 0));
      break;
    case 'newest':
      filteredCourses.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
      break;
    case 'price_low':
      filteredCourses.sort((a, b) => (a.price || 0) - (b.price || 0));
      break;
    case 'price_high':
      filteredCourses.sort((a, b) => (b.price || 0) - (a.price || 0));
      break;
  }
  
  displayCourses();
}

function loadMore() {
  currentPage++;
  displayCourses();
}

// Initialize
loadCourses();
</script>
